<!DOCTYPE html>
<html>
<head>
  <title>Option Pricer</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Option Pricer</h2>

  <form id="optionForm">
    <label>Stock Price (S):</label>
    <input type="number" id="S" value="100" step="1" required><br>

    <label>Strike Price (K):</label>
    <input type="number" id="K" value="100" step="1" required><br>

    <label>Time to Maturity (T in years):</label>
    <input type="number" id="T" value="1" step="0.1" required><br>

    <label>Risk-Free Rate (r):</label>
    <input type="number" id="r" value="0.05" step="0.01" required><br>

    <label>Volatility (Ïƒ):</label>
    <input type="number" id="sigma" value="0.2" step="0.01" required><br>

    <label>Option Type:</label>
    <select id="option_type">
      <option value="call">Call</option>
      <option value="put">Put</option>
    </select><br>

    <label>Model:</label>
    <select id="model">
      <option value="black_scholes">Black-Scholes</option>
      <option value="binomial">Binomial</option>
      <option value="monte_carlo">Monte Carlo</option>
      <option value="pde">PDE (Crank-Nicolson)</option>
    </select><br><br>

    <button type="submit">Get Price & Plot</button>
  </form>

  <div id="plot"></div>
  <p id="output"></p>

  <script>
    document.getElementById("optionForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const payload = {
        S: parseFloat(document.getElementById("S").value),
        K: parseFloat(document.getElementById("K").value),
        T: parseFloat(document.getElementById("T").value),
        r: parseFloat(document.getElementById("r").value),
        sigma: parseFloat(document.getElementById("sigma").value),
        option_type: document.getElementById("option_type").value,
        model: document.getElementById("model").value
      };
  
      try {
        const res = await fetch("/plot", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
  
        const result = await res.json();
  
        if (result.error) {
          document.getElementById("output").innerText = `Error: ${result.error}`;
          Plotly.purge("plot");  // optional: clear any existing plot
          return;
        }
  
        const plot = JSON.parse(result.plot);
        Plotly.newPlot("plot", plot.data, plot.layout);
  
        if (result.price !== undefined) {
          document.getElementById("output").innerText = `Price: $${result.price.toFixed(4)}`;
        }
  
      } catch (err) {
        document.getElementById("output").innerText = "Failed to fetch plot.";
        console.error(err);
      }
    });
  </script>  
</body>
</html>
